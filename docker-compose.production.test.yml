# Docker Compose for production testing
# This file is used ONLY for local testing and CI.
# Database is external: set DATABASE_URL in the environment (no db service).
# In CI, use a MySQL service container and DATABASE_URL with host.docker.internal.
services:
  app-production:
    build:
      context: .
      dockerfile: Dockerfile.production
      target: app
    working_dir: /var/www
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - APP_DEBUG=${APP_DEBUG}
      - APP_ENV=${APP_ENV}
      - APP_KEY=${APP_KEY}
      - APP_NAME=${APP_NAME}
      - APP_URL=${APP_URL}
      - DATABASE_URL=${DATABASE_URL}

  web-production:
    build:
      context: .
      dockerfile: Dockerfile.production
      target: web
    depends_on:
      - app-production
    expose:
      - "80"
